<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>상장 3개월 이내 신규 코인 리스트</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: black;
      color: white;
      font-family: "Noto Sans KR", sans-serif;
      width: 100vw;
      height: 100vh;
      overflow-x: hidden;
    }
    body {
      transform: scale(0.8);
      transform-origin: top left;
      width: 125%;
      height: 125%;
      padding: 40px;
    }
    h1 {
      font-size: 26px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #time { margin-bottom: 20px; font-size: 16px; color: #cccccc; }
    #countdown { margin-left: 20px; color: #888; }

    ul#coin-list {
      list-style: none;
      padding: 0;
      margin-top: 20px;
    }
    li.coin-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #111;
      margin-bottom: 8px;
      padding: 12px 20px;
      border-radius: 10px;
      transition: all 0.2s ease;
    }
    li.coin-item:hover {
      background: #222;
      transform: translateX(4px);
    }
    .symbol {
      font-weight: bold;
      font-size: 18px;
      color: #00ff88;
      cursor: pointer;
    }
    .days {
      color: #aaa;
      font-size: 14px;
    }
    .listed {
      color: #999;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <h1>■ SUPERHERO 신규 상장 코인 리스트 (3개월 이내) ■</h1>
  <div id="time">
    UTC 시간 로딩 중... <span id="countdown">다음 갱신까지 60s</span>
  </div>
  <ul id="coin-list"></ul>

  <script>
    const API_URL = "https://binance-flask-app-production.up.railway.app/recent_3m";
    let secondsToNextUpdate = 60;

    function updateTimeLabel() {
      const now = new Date();
      const y = now.getUTCFullYear();
      const m = String(now.getUTCMonth() + 1).padStart(2, '0');
      const d = String(now.getUTCDate()).padStart(2, '0');
      const h = String(now.getUTCHours()).padStart(2, '0');
      const mm = String(now.getUTCMinutes()).padStart(2, '0');
      document.getElementById("time").childNodes[0].textContent = `${y}-${m}-${d} ${h}:${mm} UTC`;
    }

    function startCountdown() {
      setInterval(() => {
        secondsToNextUpdate--;
        if (secondsToNextUpdate <= 0) secondsToNextUpdate = 60;
        document.getElementById("countdown").textContent = `다음 갱신까지 ${secondsToNextUpdate}s`;
      }, 1000);
    }

    async function fetchData() {
      try {
        const res = await fetch(API_URL);
        return await res.json();
      } catch (e) {
        console.error("API fetch error:", e);
        return [];
      }
    }

    function renderList(data) {
      const list = d3.select("#coin-list");
      list.selectAll("li").remove();

      const items = list.selectAll("li.coin-item")
        .data(data)
        .enter()
        .append("li")
        .attr("class", "coin-item");

      items.append("span")
        .attr("class", "symbol")
        .text(d => d.symbol)
        .on("click", (event, d) => {
          const url = `https://www.binance.com/en/futures/${d.symbol}`;
          window.open(url, "_blank");
        });

      items.append("span")
        .attr("class", "days")
        .text(d => `일봉 수: ${d.days}`);

      items.append("span")
        .attr("class", "listed")
        .text(d => `상장 후 약 ${d.days}일 경과`);
    }

    async function updateList() {
      updateTimeLabel();
      secondsToNextUpdate = 60;
      const data = await fetchData();
      if (!data || data.length === 0) return;

      // 일봉 적은 순 정렬
      const sorted = data.sort((a, b) => a.days - b.days);
      renderList(sorted);
    }

    updateList();
    setInterval(updateList, 60 * 1000);
    startCountdown();
  </script>
</body>
</html>
